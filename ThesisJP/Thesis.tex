%\documentclass[11pt,a4paper]{book}
\documentclass[10pt,b5paper,twoside]{book}

% Line spacing
%\linespread{1.0}

% Include document setup script
\include{documentproperties}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TITLE PAGE
\author{Jon Petter Helgesen \AA{}sen}
\title{%Integrated Ultrasound Visualization and Formation
%Real-Time Adaptive Beamforming, Visualization, and Simulation 
%Real-Time Adaptive Ultrasound Algorithms
%Accelerating adaptive ultrasound algorithms using graphics processing units 
%Accelerating adaptive ultrasound algorithms with graphics processing units 
Accelerating adaptive ultrasound imaging algorithms by means of general-purpose computing on graphics processing units 
%Accelerating adaptive ultrasound algorithms by general purpose programming on graphics processing units 
%Accelerating ultrasound algorithms with graphics processing units 
%Accelerating ultrasound algorithms using graphics processing units 
%Pinner og romber fra det yttre rom
\vspace{0.5cm}}
\department{Department of Circulation and Medical Imaging}

\usepackage{color}
\newcommand\todo[1]{{\textit{\color{red}(#1)}}}

% from Paper 1
\usepackage{colortbl}
\usepackage{appendix}

% from Paper 3
\usepackage{epstopdf}

% from spie.tex (Paper 4)
\usepackage{array}

% from hos (Paper 5)
\usepackage{url}
%\usepackage{epsfig}

% symbol list
\usepackage{nomencl}
\makenomenclature
\renewcommand{\nomname}{Symbols and Abbreviations}
\newcommand*{\nom}[2]{#1\nomenclature{#1}{#2}}
\newcommand*{\nomi}[2]{\nomenclature{#1}{#2}}

% custom commands
\newcommand{\mat}[1]{\mathbf{#1}}
\renewcommand{\vec}[1]{\mathbf{#1}}
\newcommand{\degree}{\ensuremath{^\circ}}
\newcommand{\R}{$\mat{\hat{R}}$ }

\begin{document}

\date{\today}
\pagestyle{empty} \maketitle

%Norw.  sammendrag
% Norsk sammendrag
%\Chapter*{}
\newpage%

%\setcounter{page}{1}
\renewcommand{\thepage}{\roman{page}}% Roman numerals for page counter

~\\
\vspace{10.0cm}
~\\
{\bf NTNU}
\\
Norwegian University of Science and Technology\\
\\
Thesis for the degree of Philosophiae Doctor\\
\\
Faculty of Medicine\\
Department of Circulation and Medical Imaging\\
\\
\copyright\,Jon Petter \AA{}sen\\
\\
ISBN XXX-XX-XXX-XXXX-X (printed version)\\
ISBN XXX-XX-XXX-XXXX-X (electronic version)\\
ISSN XX-XX\\
\\
Doctoral theses at NTNU, 2014:XX\\
\\
Printed by NTNU-trykk

~\\
\newpage

%\begin{otherlanguage}{norwegian}

%\thispagestyle{empty}%
%~\\%
%~\\%
%~\\
\noindent\large 
\textbf{Hurtig beregning av adaptive algoritmer for ultralydavbildning ved hjelp av programmerbare skjermkort}
%\vspace{0.2cm}\\%
\\\\%
\normalsize
De siste årene har det vært en rivende utvikling innen bruken av skjermkort (GPU-er), som egentlig er laget for å kjøre dataspill, til å gjøre numeriske beregninger for naturvitenskapelige anvendelser. Et sistegenerasjons skjermkort har nå like mye beregningskraft som verdens kraftigste datamaskin hadde rundt år 2000. Utfordringen er at problemet som skal løses må bestå av mange uavhengige deler som kan beregnes i parallell.  For ultralydmaskiner har denne utviklingen gjort at algoritmer som tideligere krevde spesialhardware, nå kan programmeres i software og kjøres i sanntid på et rimelig skjermkort. Et ultralydsystem som bruker skjermkort til å gjøre beregninger vil være mye rimeligere, mer fleksibelt og gjøre det lettere å implementere avansert prosessering enn et system hvor alle algoritmer er og må "hugges i stein".

Målet med denne studien har vært å utforske hvordan programmerbare skjermkort kan utnyttes til avansert prosessering i et avbildende ultralydsystem. Blant de problemene vi har sett nærmere på finner man både adaptiv bildedannelse (stråleforming), adaptiv visualisering av 3D ultralyd og ultralydsimuleringer. Felles for disse problemene er at de krever parallellprogrammering for å gå i sann tid.

I første del av avhandlingen utforskes Capons adaptive stråleformingsmetode. Vi starter med å implementere metoden på et skjermkort for sanntidsprosessering av sonardata (\textbf{Artikkel\,I}) og av data fra medisinsk ultralyd (\textbf{Artikkel\,II}). Sanntidsprosessering oppnås for begge modaliteter. \textbf{Artikkel\,II} presenterer også, for første gang, videoer hvor både simulerte og \textit{in vivo} medisinsk ultralyddata er prosessert med Capon-stråleforming. I \textbf{Artikkel\,III} viser vi at Capon-stråleformeren er følsom for små skift, enten ved at ultralydproben eller objektet man avbilder beveger seg. Videre foreslås det en metode som gjør at stråleformeren ikke lenger er like følsom for slike forflytninger. Dette er viktig å få på plass for at Capon-stråleformeren skal kunne tas i bruk i praksis.

I \textbf{Artikkel\,IV} foreslår vi en adaptiv metode for visualisering av 3D ultralydbilder av hjertet. Metoden undertrykker støy som med konvensjonelle metoder hadde skygget for hjertevev. Dette arbeidet viser at det med moderne skjermkort er mulig å utføre avansert visualisering i et ultralydsystem og fortsatt ha sanntidsytelse.

I siste del av avhandlingen utforsker vi hvordan skjermkort kan utnyttes til å akselerere ultralydsimuleringer. Resultatet av dette arbeidet ble et simuleringsprogram hvor geometrien til et gitt ultralydarray kan tegnes interaktivt, og hvor det resulterende trykkfeltet simuleres og visualiseres i sanntid.

\vspace{0.3cm}
\noindent Jon Petter Helgesen \AA{}sen\\
Institutt for sirkulasjon og bildediagnostikk, NTNU\\
Hovedveileder: Sverre Holm\\ 
Biveiledere: Stein-Inge Rabben, Erik Steen and Hans Torp\\
Finansieringskilde: MI-Lab

\vspace{0.2cm}
\noindent \emph{Ovennevnte avhandling er funnet verdig til \aa{} forsvares offentlig for graden Philosophiae Doctor (Ph.D.) i medisinsk teknologi. Disputas finner sted ... .}

%\end{otherlanguage}

% ENGLISH ABSTRACT / SUMMARY
\CustChapter*{Abstract}
\addcontentsline{toc}{chapter}{Abstract}
A rapid development in computer game technology and accompanying programming languages have recently provided researchers with small personal supercomputers, comprised in a single graphics processing unit (GPU). This immense rise in computational capabilities and improved programmability are currently changing how ultrasound imaging systems are designed. When researchers are exploring new algorithms for ultrasound imaging, it is therefore important to keep the architecture of parallel accelerators like the GPU in mind. If a new complex algorithm is supposed to run in real time, it needs to fit the programmable and parallel pipeline of modern ultrasound scanners.

The aim of this study has been to investigate the possibility of utilizing GPUs for advanced processing in an ultrasound imaging system. Among the investigated problems are both adaptive beamforming, adaptive visualization of ultrasound volumes, and ultrasound simulations. The presented problems have in common that they require parallel programming in order to reach real-time processing. 

In the first part of the thesis, the Capon adaptive beamformer is investigated and implemented on a GPU for the application of real-time sonar (\textbf{Paper\,I}) and medical ultrasound imaging (\textbf{Paper\,II}). Real-time frame rates are achieved for both modalities. \textbf{Paper\,II} also presents, for the first time, videos where the Capon beamformer has been applied on loops of simulated and \textit{in vivo} medical ultrasound images. In \textbf{Paper\,III}, we show that Capon beamforming does not provide shift-invariant imaging in a real-time imaging setting. A method is then proposed that improves the shift-invariant property. Shift-invariant imaging is essential if the method is ever to be used in practice.

In paper \textbf{Paper\,IV} we propose an adaptive method for visualization of volumetric cardiac ultrasound images. The method is capable of removing noise that by conventional methods would have occluded cardiac tissue. This work also shows that with modern GPUs it is possible to add advanced visualization methods to an ultrasound imaging system and still have real-time performance.

Finally, we investigate how GPUs can be utilized to accelerate ultrasound simulations (\textbf{Paper\,V}). The result of this work was a simulation program where ultrasound array geometries can be interactively drawn and where the resulting pressure field is simulated and visualized in real time.

%\setcounter{page}{3} %I don't want the norwegian summary to be counted in. (This will change page numbering since the delivered version)


% PREFACE AND ACKNOWLEDGEMENTS
\CustChapter*{Preface}%
\addcontentsline{toc}{chapter}{Preface}
%\thispagestyle{empty}%
This thesis is submitted in partial fulfillment of the requirements for the degree of \textit{Philosophiae Doctor} (Ph.D.) at the Faculty of Medicine at the Norwegian University of Science and Technology (NTNU). The research was funded by \textit{Medical Imaging Laboratory} (MI-Lab), and was carried out at the Department of Circulation and Medical Imaging. The main supervisor has been Professor Sverre Holm in the Department of Informatics (IFI), University of Oslo (UiO), and Professor II at MI-Lab, NTNU. Co-supervisors have been Ph.D. Stein Inge Rabben, Ph.D. Erik Steen, both at GE Vingmed Ultrasound AS, and Professor Hans Torp in the Department of Circulation and Medical Imaging, NTNU.


\subsubsection{Acknowledgments}
First of all I would like to thank my main supervisor Sverre Holm and the rest of my team of supervisors for all the help and guidance through the Ph.D. project. Andreas Austeng also deserves a big thank you for all valuable help and for showing so much interest in my work. Thank you to all my co-authors for their contributions. I also want to thank the Faculty of Medicine, MI-Lab and the Department of Circulation and Medical Imaging, NTNU for believing in me and making it possible to conduct this work.

During these years I have had the great pleasure of working with and getting to know several research communities and companies. I therefore would like to thank all colleagues at the Department of Circulation and Medical Imaging, NTNU, the Department of Informatics, UiO, GE Vingmed Ultrasound AS, and Squarehead Technology AS for providing great working environments. A special thanks goes to all my fellow Ph.D. students at MI-Lab. I will never forget our conference trips. A special thanks also goes to Jo Inge Buskenes in "office" 4470 at IFI, UiO for making every working hour so much fun.

Ines Hafizovic and Carl-Inge Colombo Nilsen have used their spare time to review this thesis, for which I am very grateful.  

Finally I would like to thank my family and all my friends for being there, and for providing a world away from work. But most of all, I want to thank Beate for her love and patience. Without your support I would never have managed to complete this thesis.
\null
\vfill
\hfill Dedicated to Sofie Mathilde \AA{}sen
\CustChapter*{List of publications}
\addcontentsline{toc}{chapter}{List of publications}

This thesis is based on the following five papers, referred to in the text by their Roman numerals (I-V): 
\begin{enumerate}[I]
\renewcommand\labelenumi{\bfseries\theenumi}
	\item J.\:I.\:Buskenes, \textbf{J.\:P.\:\AA{}sen}, C.-I.\:C.\:Nilsen and A.\:Austeng, "An optimized GPU implementation of the MVDR beamformer for active sonar imaging", {\it  IEEE Transactions on Oceanic Engineering, Jul 2014}.
	\item \textbf{J.\:P.\:\AA{}sen}, J.\:I.\:Buskenes, C.-I.\:C.\:Nilsen, A.\:Austeng and S.\:Holm, "Implementing Capon beamforming on a GPU for real-time cardiac ultrasound imaging", {\it IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency Control, vol. 61, no. 1, pp. 76-85, Jan 2014}.
 	\item \textbf{J.\:P.\:\AA{}sen}, A.\:Austeng and S.\:Holm, "Capon beamforming and moving objects - An analysis of lateral shift-invariance", {\it IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency Control, vol. 61, no. 7, pp. 1152-1160, Jul 2014}.
	\item \textbf{J.\:P.\:\AA{}sen}, E.\:Steen, G.\:Kiss, A.\:Thorstensen and S.\:I.\:Rabben, "Adaptive volume rendering of cardiac 3D ultrasound images - utilizing blood pool statistics", {\it Proc. SPIE Medical Imaging 2012, vol. 8320, pp. 832008}.
	\item \textbf{J.\:P.\:\AA{}sen} and S.\:Holm, "Huygens on speed: Interactive simulation of ultrasound pressure fields", {\it Proc. IEEE Ultrasonics Symposium 2012, pp. 1643-1646}.
\end{enumerate}  

\CustChapter*{Related publications}
\addcontentsline{toc}{chapter}{Related publications}
The following papers are related to the included papers, and are referred to in the text by their Roman numerals: 

\begin{enumerate}[VI]
\setcounter{enumi}{5}
\renewcommand\labelenumi{\bfseries\theenumi}

	\item \textbf{J.\:P.\:\AA{}sen}, J.\:I.\:Buskenes, C.-I.\:C.\:Nilsen, A.\:Austeng and S.\:Holm, "Implementing Capon Beamforming on the GPU for Real-Time Cardiac Ultrasound Imaging", {\it Proc. IEEE Ultrasonics Symposium 2012, pp. 2133-2136}.

	\item J.\:I.\:Buskenes, \textbf{J.\:P.\:\AA{}sen}, C.-I.\:C.\:Nilsen and A.\:Austeng, "Adapting the Minimum variance beamformer to a graphics processing unit for active sonar imaging systems", {\it Proc. Meetings on Acoustics 2013, vol. 13}. \textit{Invited talk}.
	
	\item G.\:Kiss, E.\:Steen, \textbf{J.\:P.\:\AA{}sen} and H.\:Torp, "GPU volume rendering in 3D echocardiography: real-time pre-processing and ray-casting", {\it Proc. IEEE Ultrasonics Symposium 2010, pp. 193-196}.

	%\item G. Kiss, \textbf{J. P. \AA{}sen}, J. Bogaert, B. H. Amundsen, P. Claus, J. R. M. D'hooge and H. Torp, "Multi-modal cardiac image fusion and visualization on the GPU", {\it Proc. IEEE Ultrasonics Symposium 2011}.

	\item E.\:S.\:Br\o{}nstad, \textbf{J.\:P.\:\AA{}sen}, H.\:Torp and G.\:Kiss, "Visibility driven visualization of 3D cardiac ultrasound data on the GPU", {\it Proc. IEEE Ultrasonics Symposium 2012, pp. 2651-2654}.
\end{enumerate}

\newpage\thispagestyle{empty}
\pagestyle{fancy}

%

\cleardoublepage
\addcontentsline{toc}{chapter}{Contents}
\renewcommand*\contentsname{Contents}
\tableofcontents

\cleardoublepage
\addcontentsline{toc}{chapter}{Symbols and Abbreviations}
\printnomenclature

\cleardoublepage
\setcounter{page}{1}
\renewcommand{\thepage}{\arabic{page}}

%\renewcommand*\thesection{\arabic{section}}

%%%% CHAPTER 2 %%%%
\begin{bibunit}[IEEEtran]
\CustChapter{Background}\label{chap1}
\runningtitle{Background}
\input{./Background/background}

\CustChapter{Introduction to Papers} 
\runningtitle{Introduction to Papers}
\input{./Introduction/introduction}

\newpage\addcontentsline{toc}{chapter}{References} 
\putbib[./Background/background]
\end{bibunit}

%\setcounter{section}{0}
%\setcounter{chapter}{1}

%%%% CHAPTER 1 %%%%

\setcounter{chapter}{0}

%%%% Paper 1 %%%%
\begin{bibunit}[IEEEtran]
\CustChapterPaper{An Optimized GPU Implementation of the MVDR Beamformer for Active Sonar Imaging}
\runningtitle{GPU MVDR Beamformer for Active Sonar Imaging}
\authors{
	Jo Inge Buskenes$^{1}$, 
    	\textbf{Jon Petter \AA{}sen}$^{2}$, 
    	Carl-Inge C. Nilsen$^{1}$ and
    	Andreas Austeng$^{1}$
} 
{
	$^{1}$Department of Informatics, University of Oslo, Oslo, Norway\\
    	$^{2}$Medical Imaging Lab (MI-Lab), Norwegian University of Science and Technology, Trondheim, Norway
}
\noindent \textit{IEEE Transactions on Oceanic Engineering, Jun 2014}.
\newpage
{
\input{./Paper1/howto_howto_capon}
}
\newpage\addcontentsline{toc}{section}{References}
\putbib[./Paper1/library]
\end{bibunit}

\setcounter{chapter}{1}

%%%% Paper 2 %%%%
\begin{bibunit}[IEEEtran]
\CustChapterPaper{Implementing Capon Beamforming on a GPU for Real-Time Cardiac Ultrasound Imaging}
\runningtitle{GPU Capon Beamformer for Cardiac Ultrasound Imaging}
\authors{
	\textbf{Jon Petter \AA{}sen}$^{1}$,
    	Jo Inge Buskenes$^{2}$,  
    	Carl-Inge C. Nilsen$^{2}$,
    	Andreas Austeng$^{2}$ and
    	Sverre Holm$^{1,2}$
} 
{
	$^{1}$Medical Imaging Lab (MI-Lab), Norwegian University of Science and Technology, Trondheim, Norway\\
    	$^{2}$Department of Informatics, University of Oslo, Oslo, Norway
}
\noindent \textit{IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency Control, vol. 61, pp. 76-85, Jan 2014}.
\newpage
{\input{./Paper2/cos}}
\newpage
\addcontentsline{toc}{section}{References}
\putbib[./Paper2/cosbib]
\end{bibunit}


%%%% Paper 3 %%%%
\begin{bibunit}[IEEEtran]
\CustChapterPaper{Capon Beamforming and Moving Objects - An Analysis of Lateral Shift-Invariance}
\runningtitle{Capon Beamforming and Moving Objects}
\authors{
	\textbf{Jon Petter \AA{}sen}$^{1}$, 
    	Andreas Austeng$^{2}$ and
    	Sverre Holm$^{1,2}$
} 
{
	$^{1}$Medical Imaging Lab (MI-Lab), Norwegian University of Science and Technology, Trondheim, Norway\\
    	$^{2}$Department of Informatics, University of Oslo, Oslo, Norway
}
\noindent \textit{IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency Control, , vol. 61, no. 7, pp. 1152-1160, Jul 2014}.
\newpage\input{./Paper3/moving_obj}
\newpage\addcontentsline{toc}{section}{References}
\putbib[./Paper3/moving_objbib]
\end{bibunit}


%%%% Paper 4 %%%%
\begin{bibunit}[IEEEtran]
\CustChapterPaper{Adaptive Volume Rendering of Cardiac 3D Ultrasound Images - Utilizing Blood Pool Statistics}
\runningtitle{Adaptive Volume Rendering of Cardiac Ultrasound}
\authors{
	\textbf{Jon Petter \AA{}sen}$^{1}$,
	Erik Steen$^2$,
	Gabriel Kiss$^{3,4}$,
	Anders Thorstensen$^{1,5}$,
	Stein Inge Rabben$^2$
}
{
$^{1}$Medical Imaging Lab (MI-Lab), Norwegian University of Science and Technology, Trondheim, Norway\\
$^{2}$ GE Vingmed Ultrasound, Horten, Norway\\
$^{3}$ Norwegian University of Science and Technology, ISB - Department of Circulation and Medical Imaging, Trondheim, Norway\\
$^{4}$ St. Olavs Hospital, Trondheim, Norway\\
$^{5}$ Department of Cardiology, St. Olavs Hospital, Trondheim, Norway
}
\noindent \textit{Proc. SPIE Medical Imaging 2012, vol. 8320, pp. 832008.}
\newpage\input{./Paper4/spie}
\newpage\addcontentsline{toc}{section}{References}
\putbib[./Paper4/spiebib]
\end{bibunit}

%%%% Paper 5 %%%%
\begin{bibunit}[IEEEtran]
\CustChapterPaper{Huygens on Speed: Interactive Simulation of Ultrasound Pressure Fields}
\runningtitle{Huygens on speed}
\authors{\textbf{Jon Petter \AA{}sen}$^1$ and Sverre Holm$^{1,2}$}
{
	$^{1}$Medical Imaging Lab (MI-Lab), Norwegian University of Science and Technology, Trondheim, Norway\\
    	$^{2}$Department of Informatics, University of Oslo, Oslo, Norway
}
\noindent \textit{Proc. IEEE Ultrasonics Symposium 2012, pp. 1643-1646}.
\newpage\input{./Paper5/hos}
\newpage\addcontentsline{toc}{section}{References}
\putbib[./Paper5/hosbib]
\end{bibunit}

%\appendix

\end{document}
